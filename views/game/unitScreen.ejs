<%
    let unitType = unit.unitType.name;
    let movesRemaining = unit.movesRemaining > 0;
    let inRivalTerritory = tiles.filter(tile => {
        return unit.location[0] == tile.row && unit.location[1] == tile.column
            && tile.player && '' + tile.player != '' + turnPlayerId;
    }).length > 0;
    let tile = findTile(unit.location);
    let isForest = tile.terrain.forest;

    let actions = [];

    if (unitType == 'settler') {
        actions.push({
            path: '/foundCity/' + unit._id,
            disabled: unit.movesRemaining == 0 || !inRivalTerritory,
            text: 'found city',
        });
    } else if (unitType == 'worker') {
        actions.push({
            path: '/unitOrders/' + unit._id + '/buildFarm',
            disabled: unit.movesRemaining == 0 || isForest,
            text: 'build farm',
        });
    }

    if (unit.orders == 'sleep') {
        actions.push({
            path: '/unitOrders/' + unit._id + '/wake',
            text: 'wake',
        });
    } else if (movesRemaining) {
        actions.push({
            path: '/unitOrders/' + unit._id + '/sleep',
            text: 'sleep',
        });
    }

    if (movesRemaining) {
        actions.push({
            path: '/unitOrders/' + unit._id + '/skipTurn',
            text: 'skip turn',
        });
    }
%>

<div class="info unit" unit-id="<%= unit._id %>">
    <div class="close">X</div>
    <div>
        <b>type:</b>
        <%= unit.unitType.name %>
    </div>
    <div>
        <b>moves:</b>
        <%= unit.movesRemaining %>
    </div>
    <div>
        <b>orders:</b>
        <% if (unit.orders) { %>
            <%= unit.orders %>
        <% } else { %>
            NONE
        <% } %>
    </div>

    <div>
        <b>actions:</b>

        <% actions.forEach(action => { %>
            <form action="<%= action.path %>" method="post">
                <% if (action.disabled) { %>
                    <button disabled="disabled"><%= action.text %></button>
                <% } else { %>
                    <button type="submit"><%= action.text %></button>
                <% } %>
            </form>
        <% }); %>
    </div>
</div>
