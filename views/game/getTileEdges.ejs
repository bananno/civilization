<%
  for (let r = 0; r < numRows; r++) {
    const shiftRow = r % 2 == 0;
    for (let c = 0; c < numCols; c++) {

      if (!map[r][c].discovered) {
        continue;
      }

      const inWater = map[r][c].tile.terrain.water;

      let c1 = helpers.getColumn(numCols, c - 1);
      let c2 = helpers.getColumn(numCols, c + 1);

      const edges = {};
      const coasts = {};

      edges.left = !map[r][c1].discovered;
      edges.right = !map[r][c2].discovered;

      coasts.left = inWater != map[r][c1].tile.terrain.water;
      coasts.right = inWater != map[r][c2].tile.terrain.water;

      if (shiftRow) {
        c1 = c;
      } else {
        c2 = c;
      }

      if (r > 0) {
        edges.topLeft = !map[r - 1][c1].discovered;
        edges.topRight = !map[r - 1][c2].discovered;
        coasts.topLeft = inWater != map[r - 1][c1].tile.terrain.water;
        coasts.topRight = inWater != map[r - 1][c2].tile.terrain.water;
      }

      if (r < numRows - 1) {
        edges.bottomLeft = !map[r + 1][c1].discovered;
        edges.bottomRight = !map[r + 1][c2].discovered;
        coasts.bottomLeft = inWater != map[r + 1][c1].tile.terrain.water;
        coasts.bottomRight = inWater != map[r + 1][c2].tile.terrain.water;
      }

      if (edges.topLeft && edges.topRight) {
        map[r][c].edges.push('side-dark side-top');
      }

      if (edges.left) {
        map[r][c].edges.push('side-dark side-left');
      }

      if (edges.bottomLeft && edges.bottomRight) {
        map[r][c].edges.push('side-dark side-bottom');
      }

      if (edges.right) {
        map[r][c].edges.push('side-dark side-right');
      }

      if (coasts.left) {
        if (coasts.topLeft) {
          map[r][c].coasts.push('layer-curve-top-left');
        }
        if (coasts.bottomLeft) {
          map[r][c].coasts.push('layer-curve-bottom-left');
        }
      }

      if (coasts.right) {
        if (coasts.topRight) {
          map[r][c].coasts.push('layer-curve-top-right');
        }
        if (coasts.bottomRight) {
          map[r][c].coasts.push('layer-curve-bottom-right');
        }
      }
    }
  }
%>
