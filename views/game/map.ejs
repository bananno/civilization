<%
    let showTestMap = false;
%>

<style>
<% if (showTestMap) { %>
    .map-cell.boardnum-1 {
      border: 1px solid white;
    }
    .map-cell.boardnum-0,
    .map-cell.boardnum-2 {
      border: 1px solid red;
    }
    .map-cell.off-screen.boardnum-1 {
      border-color: #555;
    }
    .map-cell.off-screen.boardnum-0,
    .map-cell.off-screen.boardnum-2 {
      border-color: pink;
    }
    .map-cell.center {
      border-color: blue;
    }
<% } else { %>
    .map-cell.off-screen {
      display: none;
    }
<% } %>
</style>

<div id="map">
    <table>
        <% map.forEach((row, r) => { %>
            <tr class="map-row" row="<%= r %>">
                <% for (let boardnum = 0; boardnum < 3; boardnum++) { %>
                    <% row.forEach((cell, c) => { %>
                        <%
                            let className = 'map-cell boardnum-' + boardnum;
                            if (boardnum != 1) {
                                className += ' off-screen';
                            }
                            if (cell.player) {
                                className += ' player' + cell.player;
                            }
                            if (cell.lit || cell.owned) {
                                className += ' lit';
                            } else if (cell.discovered) {
                                className += ' discovered';
                            } else {
                                className += ' dark';
                            }
                        %>
                        <td class="<%= className %>" row="<%= r %>" column="<%= c %>">
                            <% if (cell.city) { %>
                                &#9733;
                            <% } %>
                            <% if (cell.myUnit || cell.rivalUnit) { %>
                                <%
                                    let unitClass = 'unit ' + (cell.myUnit ? 'turn' : 'rival');
                                    let unit = unitsById[cell.unitId];
                                    let unitImage = unit.unitType.name;
                                %>
                                <div class="<%= unitClass %>" unit-id="<%= cell.unitId %>">
                                    <img src="/images/units/<%= unitImage %>.png">
                                </div>
                            <% } else { %>
                                <% cell.moves.forEach(move => { %>
                                    <form action="<%= move.path %>" method="post" class="move-unit"
                                        unit-id="<%= move.unitId %>">
                                        <button type="submit"> </button>
                                    </form>
                                <% }); %>
                            <% } %>
                        </td>
                    <% }); %>
                <% } %>
            </tr>
        <% }); %>
    </table>
</div>
